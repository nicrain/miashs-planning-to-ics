# æ–‡ä»¶å: .github/workflows/update.yml

name: Scheduled Calendar Generator

on:
  # ä½¿ç”¨ Cron è¯­æ³•è®¾ç½®å®šæ—¶è¿è¡Œã€‚
  # ç¤ºä¾‹ï¼š'0 */4 * * *' è¡¨ç¤ºæ¯ 4 å°æ—¶æ‰§è¡Œä¸€æ¬¡ (UTC æ—¶é—´)
  schedule:
    - cron: '0 */4 * * *' 
  # å…è®¸åœ¨ GitHub ç•Œé¢æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®è¿è¡Œï¼Œæ–¹ä¾¿æµ‹è¯•
  workflow_dispatch:

jobs:
  update_calendar:
    runs-on: ubuntu-latest
    steps:
      # 1. æ£€å‡ºä»£ç 
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # å¿…é¡»è®¾ç½® fetch-depth: 0ï¼Œå¦åˆ™æ— æ³•åœ¨åç»­æ­¥éª¤ä¸­æäº¤ä»£ç 
          fetch-depth: 0
          
      # 2. è®¾ç½® Python ç¯å¢ƒ
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10' # ç¡®ä¿ä½¿ç”¨æ‚¨éœ€è¦çš„ Python ç‰ˆæœ¬

      # 3. å®‰è£…ä¾èµ–
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          # !!! å°†æ‚¨çš„ç¬¬ä¸‰æ–¹ä¾èµ–åº“æ›¿æ¢æˆ–æ·»åŠ åˆ°è¿™é‡Œ !!!
          pip install requests beautifulsoup4 ics 

      # 4. è¿è¡Œè„šæœ¬ï¼Œç”Ÿæˆ ICS æ–‡ä»¶
      - name: Execute Python Script
        run: python planning.py

      # 5. è‡ªåŠ¨æäº¤å’Œæ¨é€æ›´æ–°çš„æ–‡ä»¶
      - name: Commit and Push new ICS file
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # æäº¤ä¿¡æ¯ï¼ŒåŠ ä¸Š [skip ci] é¿å…å†æ¬¡è§¦å‘æ–°çš„ workflow è¿è¡Œ
          commit_message: "ğŸ¤– Feat: Auto update calendar.ics [skip ci]"
          # åªæäº¤ç”Ÿæˆçš„ ICS æ–‡ä»¶
          files: master_handi_schedule.ics
